SET NOCOUNT ON

DECLARE @MerchCostChangeEffectiveDate AS smalldatetime
SET		@MerchCostChangeEffectiveDate = CONVERT(smalldatetime, SYSDATETIME())

DECLARE @supplier TABLE (supplier_id INT, name nvarchar(128))
DECLARE @business_unit TABLE (business_unit_id INT)

-- Added for support of incremental extract
DECLARE	@last_max_id	INT
-- Set this to the max Item Id from the last extract
SET		@last_max_id	= 0
-- END for additional changes

INSERT @business_unit
SELECT data_accessor_id
FROM rad_sys_data_accessor AS rsda
WHERE rsda.name IN (
'0006953',
'0007001',
'0007640',
'0005402',
'0006303',
'0006096',
'0006031',
'0006523',
'0005238',
'0007513',
'0006472',
'0005340',
'0006202',
'0006588',
'0007180',
'0005562',
'0005498',
'0004897',
'0006325',
'0006753',
'0004665',
'0007435',
'0007448',
'0007025',
'0006963',
'0006457',
'0007669',
'0005028',
'0006533',
'0006489',
'0007391',
'0006422',
'0004776',
'0006503',
'0006670',
'0005525',
'0007216',
'0006973',
'0006862',
'0006776',
'0006943',
'0006579',
'0006689',
'0007596',
'0006410',
'0007458',
'0005546',
'0005370',
'0006611',
'0006982',
'0007664',
'0006731',
'0006896',
'0006620',
'0007048',
'0005496',
'0005079',
'0007623',
'0007535',
'0006461',
'0006117',
'0004861',
'0007407',
'0005166',
'0006086',
'0005172',
'0006439',
'0006108',
'0004671',
'0007628',
'0005018',
'0006938',
'0006521',
'0006797',
'0006762',
'0007070',
'0006935',
'0007148',
'0007118',
'0006493',
'0006939',
'0006308',
'0006718',
'0006009',
'0005298',
'0006420',
'0006526',
'0006663',
'0007645',
'0006553',
'0007568',
'0006860',
'0006966',
'0007102',
'0006149',
'0005218',
'0006913',
'0006741',
'0007612',
'0005511',
'0006427',
'0006926',
'0006506',
'0006434',
'0005204',
'0006867',
'0007553',
'0004778',
'0006946',
'0006874',
'0005373',
'0006724',
'0006872',
'0006519',
'0006407',
'0006879',
'0006894',
'0006563',
'0006239',
'0007350',
'0006514',
'0007139',
'0005200',
'0007575',
'0007164',
'0006984',
'0006954',
'0006543',
'0007496',
'0006933',
'0007071',
'0007123',
'0007658',
'0006903',
'0006589',
'0006450',
'0005381',
'0007434',
'0006234',
'0006729',
'0005161',
'0007622',
'0007542',
'0006651',
'0006802',
'0007556',
'0004676',
'0006771',
'0007515',
'0004664',
'0006524',
'0004863',
'0006959',
'0005110',
'0006964',
'0006467',
'0005515',
'0006195',
'0006660',
'0005409',
'0006616',
'0007209',
'0006466',
'0006425',
'0006604',
'0005514',
'0006906',
'0007562',
'0006479',
'0006679',
'0005556',
'0007105',
'0006210',
'0006764',
'0006319',
'0007171',
'0006447',
'0006755',
'0005120',
'0007108',
'0005410',
'0005376',
'0006726',
'0005009',
'0006807',
'0006758',
'0006297',
'0006983',
'0006554',
'0006460',
'0007137',
'0004860',
'0007610',
'0006700',
'0006676',
'0005173',
'0005417',
'0006517',
'0005404',
'0007606',
'0006882',
'0006433',
'0006763',
'0005343',
'0006957',
'0007152',
'0006218',
'0007373',
'0006499',
'0007586',
'0006873',
'0006092',
'0007592',
'0006712',
'0006662',
'0006063',
'0006559',
'0004674',
'0004807',
'0006570',
'0007131',
'0005344',
'0006931',
'0006745',
'0006582',
'0006527',
'0004893',
'0007670',
'0006043',
'0006967',
'0006656',
'0006453',
'0007117',
'0006127',
'0006538',
'0006537',
'0005554',
'0006483',
'0006105',
'0006507',
'0006150',
'0006064',
'0006977',
'0006451',
'0006866',
'0006272',
'0006772',
'0007651',
'0006947',
'0006590',
'0006766',
'0005284',
'0006414',
'0006725',
'0007661',
'0007220',
'0006406',
'0006995',
'0006854',
'0006985',
'0006615',
'0005289',
'0006561',
'0005457',
'0007660',
'0006557',
'0006892',
'0007106',
'0006215',
'0006917',
'0006884',
'0007400',
'0007151',
'0006999',
'0007412',
'0007090',
'0006430',
'0005015',
'0006594',
'0005105',
'0007591',
'0007576',
'0007601',
'0006781',
'0005108',
'0006540',
'0006525',
'0007630',
'0005215',
'0006459',
'0006240',
'0006898',
'0006900',
'0006497',
'0006125',
'0006124',
'0006680',
'0007639',
'0006740',
'0006927',
'0006441',
'0006376',
'0007134',
'0006097',
'0007440',
'0006535',
'0006940',
'0006080',
'0006801',
'0006864',
'0005165',
'0005351',
'0007112',
'0006975',
'0004667',
'0005387',
'0006727',
'0006907',
'0006560',
'0006454',
'0006416',
'0007382',
'0006934',
'0006765',
'0007455',
'0006446',
'0005334',
'0005493',
'0006327',
'0006593',
'0006567',
'0005480',
'0006895',
'0006655',
'0005241',
'0006941',
'0006775',
'0005073',
'0006952',
'0006664',
'0005299',
'0007526',
'0007172',
'0007153',
'0006383',
'0005239',
'0006778',
'0005416',
'0005505',
'0007593',
'0007571',
'0006133',
'0005399',
'0006980',
'0005071',
'0007613',
'0005494',
'0007154',
'0007165',
'0007143',
'0007594',
'0006658',
'0007026',
'0007127',
'0007583',
'0005265',
'0007017',
'0006785',
'0006143',
'0007635',
'0005036',
'0007626',
'0005254',
'0006532',
'0006336',
'0006562',
'0006583',
'0004672',
'0006139',
'0006050',
'0005524',
'0004660',
'0007632',
'0005400',
'0006490',
'0006278',
'0006899',
'0006411',
'0006746',
'0007111',
'0006463',
'0006482',
'0007534',
'0005222',
'0006120',
'0006470',
'0006456',
'0007641',
'0006902',
'0007101',
'0006730',
'0006647',
'0006666',
'0006760',
'0005491',
'0006443',
'0006751',
'0006504',
'0006777',
'0005500',
'0007585',
'0006904',
'0006803',
'0006944',
'0007464',
'0005456',
'0006661',
'0005014',
'0006728',
'0006961',
'0006610',
'0006910',
'0007114',
'0006152',
'0005464',
'0006541',
'0005135',
'0006437',
'0006060',
'0005548',
'0006901',
'0007128',
'0006877',
'0006440',
'0007666',
'0006716',
'0006711',
'0007637',
'0004670',
'0005128',
'0006800',
'0006782',
'0007113',
'0004666',
'0006586',
'0007611',
'0006492',
'0006243',
'0006856',
'0007398',
'0007018',
'0006652',
'0006513',
'0005098',
'0006683',
'0007519',
'0005183',
'0007672',
'0005550',
'0007073',
'0006528',
'0006795',
'0007372',
'0007587',
'0007135',
'0006798',
'0006544',
'0007509',
'0005362',
'0006022',
'0005332',
'0007421',
'0007621',
'0006958',
'0006429',
'0005516',
'0005518',
'0007646',
'0006572',
'0007218',
'0006981',
'0007654',
'0006744',
'0006010',
'0006445',
'0005542',
'0006932',
'0007633',
'0006531',
'0006805',
'0006426',
'0006477',
'0007036',
'0005527',
'0006880',
'0006688',
'0007404',
'0006645',
'0006992',
'0007155',
'0005160',
'0005237',
'0006220',
'0006345',
'0006599',
'0006412',
'0007595',
'0007572',
'0006756',
'0006027',
'0007505',
'0007016',
'0006106',
'0007162',
'0007634',
'0005211',
'0007445',
'0006244',
'0005154',
'0006733',
'0006747',
'0007504',
'0007490',
'0006475',
'0006675',
'0006684',
'0006869',
'0006140',
'0007104',
'0006636',
'0006462',
'0005194',
'0007047',
'0006754',
'0006114',
'0007384',
'0006505',
'0004663',
'0007250',
'0007158',
'0006236',
'0006945',
'0006780',
'0006372',
'0006761',
'0006481',
'0006677',
'0006597',
'0006404',
'0006241',
'0006516',
'0005157',
'0006508',
'0007146',
'0007138',
'0005489',
'0006956',
'0006418',
'0007176',
'0006116',
'0005378',
'0007406',
'0006555',
'0007115',
'0006792',
'0007122',
'0006305',
'0006568',
'0007410',
'0006739',
'0005509',
'0007147',
'0006783',
'0007674',
'0005393',
'0006791',
'0007510',
'0006051',
'0007022',
'0006066',
'0006242',
'0006657',
'0006890',
'0007190',
'0006682',
'0006587',
'0006998',
'0006529',
'0007631',
'0005235',
'0006046',
'0006612',
'0007648',
'0006494',
'0004892',
'0005081',
'0006415',
'0006742',
'0006486',
'0006428',
'0005517',
'0007403',
'0006905',
'0006452',
'0005004',
'0006855',
'0006094',
'0006789',
'0005163',
'0006444',
'0006928',
'0005333',
'0005117',
'0006556',
'0005495',
'0005519',
'0006804',
'0005037',
'0005504',
'0007401',
'0007136',
'0006288',
'0006767',
'0005236',
'0006431',
'0006686',
'0005010',
'0006614',
'0005547',
'0006871',
'0007140',
'0005384',
'0007110',
'0006969',
'0004669',
'0005286',
'0007107',
'0006710',
'0007428',
'0005043',
'0005208',
'0006790',
'0006865',
'0006545',
'0007560',
'0007671',
'0006868',
'0007590',
'0006141',
'0007662',
'0006201',
'0005034',
'0005179',
'0006581',
'0006566',
'0006458',
'0006786',
'0007427',
'0007015',
'0005269',
'0004662',
'0005266',
'0005338',
'0006496',
'0005169',
'0006455',
'0006247',
'0005274',
'0006659',
'0007027',
'0006480',
'0007408',
'0007450',
'0007091',
'0006779',
'0006687',
'0005528',
'0007077',
'0006858',
'0006951',
'0006968',
'0006774',
'0005227',
'0006138',
'0006488',
'0006773',
'0007177',
'0005544',
'0007625',
'0007173',
'0005379',
'0005064',
'0007642',
'0006393',
'0006569',
'0007598',
'0006654',
'0007616',
'0006510',
'0006889',
'0005462',
'0005460',
'0007527',
'0006473',
'0007032',
'0007439',
'0006135',
'0006708',
'0006409',
'0007627',
'0007409',
'0005123',
'0004673',
'0006293',
'0006752',
'0006023',
'0006564',
'0005153',
'0005401',
'0006491',
'0007600',
'0005492',
'0005264',
'0006743',
'0007494',
'0005390',
'0006471',
'0006671',
'0006207',
'0006438',
'0004768',
'0007597',
'0006144',
'0007181',
'0005031',
'0006078',
'0007100',
'0007126',
'0006929',
'0005503',
'0006584',
'0007024',
'0005016',
'0006750',
'0006948',
'0006565',
'0005253',
'0006368',
'0007029',
'0005243',
'0007465',
'0007665',
'0006571',
'0006897',
'0006784',
'0006485',
'0007524',
'0007638',
'0006673',
'0006937',
'0006487',
'0006245',
'0006681',
'0006384',
'0006085',
'0007124',
'0005182',
'0007030',
'0005011',
'0006685',
'0006112',
'0005252',
'0004896',
'0006101',
'0006551',
'0006796',
'0007667',
'0007346',
'0006887',
'0007668',
'0006911',
'0006878',
'0006788',
'0006914',
'0006275',
'0004777',
'0007655',
'0006787',
'0007430',
'0007363',
'0005263',
'0007159',
'0006530',
'0007329',
'0006876',
'0006246',
'0007540',
'0006799',
'0006970',
'0006717',
'0006065',
'0006794',
'0006548',
'0007097',
'0006598',
'0006413',
'0006719',
'0007156',
'0006991',
'0006132',
'0006853',
'0006634',
'0007569',
'0006748',
'0007647',
'0006629',
'0006732',
'0007163',
'0005196',
'0006474',
'0006304',
'0006552',
'0005282',
'0006646',
'0007306',
'0005033',
'0006912',
'0006595',
'0007405',
'0006723',
'0007599',
'0005091',
'0006512',
'0005181',
'0006435',
'0006408',
'0007422',
'0006936',
'0005249',
'0007096',
'0005543',
'0006875',
'0007589',
'0005380',
'0007167',
'0006908',
'0006235',
'0006709',
'0006930',
'0007103',
'0006714',
'0006476',
'0007584',
'0006735',
'0007503',
'0006988',
'0005487',
'0006809',
'0007184',
'0005566',
'0006757',
'0006436',
'0006585',
'0006949',
'0007330',
'0006237',
'0006238',
'0007523',
'0005075',
'0006674',
'0005521',
'0006424',
'0006515',
'0006596',
'0005485',
'0004668',
'0005360',
'0006770',
'0007183',
'0006419',
'0006128',
'0006478',
'0006986',
'0005488',
'0007649',
'0006649',
'0005149',
'0006549',
'0007109',
'0006738',
'0006870',
'0006768',
'0006650',
'0006759',
'0005118',
'0005508',
'0005348',
'0005259',
'0006891',
'0005162',
'0007288',
'0005007',
'0006558',
'0004675',
'0006994',
'0006131',
'0007636',
'0006793',
'0006618',
'0007657',
'0007644',
'0006498',
'0004864',
'0006806',
'0005405',
'0006522',
'0006495',
'0006859',
'0006965',
'0006734',
'0006962',
'0006448',
'0007279',
'0005005',
'0006095',
'0005276',
'0005499',
'0007656',
'0006580',
'0005507',
'0006971',
'0007020',
'0006863',
'0006997',
'0006942',
'0005839',
'0006432',
'0006720',
'0007461',
'0006893',
'0006648',
'0005558',
'0005522',
'0005074',
'0004862',
'0006713',
'0007652',
'0006621',
'0006909',
'0007120',
'0007629',
'0006950',
'0007514',
'0006989',
'0006630',
'0005089',
'0006808',
'0007663',
'0006539',
'0006312',
'0006219',
'0006888',
'0007322',
'0006395',
'0006534',
'0007511',
'0006591',
'0006520',
'0006974',
'0006653',
'0006960',
'0005224',
'0006417',
'0006421',
'0005268',
'0006672',
'0006857',
'0006861',
'0005207',
'0007643',
'0005174',
'0006736',
'0007166',
'0006925',
'0006722',
'0007272',
'0007402',
'0006987',
'0006979',
'0007383',
'0006348',
'0006276',
'0007673',
'0005413',
'0007624',
'0006769',
'0006678',
'0007459',
'0007142',
'0006972',
'0009960',
'0009974',
'0009969',
'0009968',
'0009954',
'0009964',
'0009983',
'0009987',
'0009978',
'0009970',
'0009956',
'0009986',
'0009950',
'0009957',
'0009966',
'0009982',
'0009958',
'0009946',
'0009971',
'0009980',
'0009952',
'0009981',
'0009979',
'0009945',
'0009944',
'0009975',
'0009953',
'0009962',
'0009976',
'0009955',
'0009967',
'0009977',
'0009965',
'0009947',
'0009985',
'0009984',
'0009972',
'0009949',
'0009948',
'0009951',
'0009963',
'0009973',
'0009959',
'0009626',
'0008214',
'0008862',
'0008658',
'0008724',
'0008785',
'0008065',
'0009248',
'0008207',
'0009326',
'0007714',
'0009522',
'0008057',
'0007953',
'0009361',
'0008762',
'0009575',
'0009726',
'0008014',
'0008032',
'0009355',
'0008854',
'0008736',
'0008805',
'0008327',
'0008282',
'0007954',
'0008859',
'0008826',
'0007875',
'0007965',
'0008495',
'0008280',
'0009218',
'0008308',
'0008206',
'0008753',
'0008339',
'0007826',
'0008537',
'0008055',
'0008044',
'0008226',
'0007992',
'0009163',
'0007707',
'0009919',
'0008840',
'0008209',
'0008656',
'0009557',
'0008042',
'0008626',
'0009710',
'0007880',
'0008534',
'0008400',
'0009339',
'0008294',
'0009224',
'0007892',
'0008392',
'0009183',
'0009232',
'0009510',
'0007858',
'0008024',
'0009765',
'0009312',
'0008808',
'0009916',
'0007901',
'0009043',
'0007740',
'0009751',
'0007975',
'0008600',
'0009366',
'0008765',
'0009942',
'0008883',
'0009935',
'0007886',
'0008676',
'0009927',
'0008873',
'0007897',
'0008664',
'0007876',
'0008228',
'0007803',
'0007914',
'0007737',
'0008806',
'0007923',
'0009566',
'0007925',
'0009402',
'0007679',
'0009656',
'0008386',
'0008884',
'0008266',
'0008591',
'0008221',
'0008876',
'0007970',
'0007991',
'0009270',
'0008287',
'0008211',
'0008038',
'0007677',
'0008749',
'0007999',
'0008539',
'0007913',
'0009599',
'0007828',
'0008722',
'0009511',
'0009934',
'0007931',
'0008679',
'0007700',
'0008072',
'0008759',
'0007732',
'0009732',
'0009269',
'0008064',
'0007873',
'0009293',
'0007717',
'0009383',
'0007790',
'0009693',
'0007860',
'0009706',
'0007905',
'0008713',
'0008049',
'0007935',
'0007928',
'0009053',
'0009585',
'0009728',
'0009712',
'0008763',
'0007684',
'0009237',
'0008520',
'0007853',
'0009631',
'0008674',
'0009153',
'0008861',
'0008804',
'0009028',
'0007747',
'0009379',
'0008662',
'0007874',
'0008277',
'0007789',
'0009194',
'0007902',
'0008333',
'0009938',
'0007916',
'0009700',
'0007838',
'0007955',
'0009611',
'0007993',
'0008200',
'0009554',
'0009628',
'0009035',
'0008653',
'0007804',
'0008210',
'0008820',
'0009711',
'0008395',
'0008284',
'0007704',
'0009675',
'0007710',
'0009239',
'0009906',
'0007926',
'0008180',
'0008191',
'0009702',
'0008268',
'0009341',
'0009917',
'0008714',
'0009368',
'0007847',
'0009290',
'0008081',
'0007961',
'0009730',
'0009645',
'0007891',
'0009514',
'0009578',
'0009601',
'0008673',
'0007930',
'0007712',
'0009630',
'0008281',
'0008061',
'0008292',
'0008493',
'0009263',
'0007809',
'0008316',
'0009659',
'0007834',
'0007723',
'0009541',
'0008502',
'0008387',
'0007896',
'0008766',
'0007889',
'0009609',
'0007915',
'0007681',
'0008403',
'0008286',
'0008799',
'0008727',
'0009725',
'0007676',
'0008491',
'0007947',
'0007984',
'0008273',
'0007744',
'0008863',
'0008723',
'0009342',
'0008051',
'0007813',
'0008789',
'0007713',
'0007771',
'0008082',
'0009640',
'0007989',
'0007822',
'0008183',
'0008825',
'0007791',
'0009673',
'0008730',
'0007703',
'0009358',
'0007885',
'0008048',
'0009937',
'0009678',
'0008768',
'0008029',
'0009667',
'0009605',
'0007872',
'0009236',
'0007709',
'0007749',
'0008613',
'0008796',
'0008729',
'0008669',
'0007840',
'0009284',
'0007852',
'0009781',
'0007750',
'0008532',
'0009260',
'0008887',
'0007936',
'0009603',
'0007956',
'0009607',
'0008231',
'0009746',
'0007893',
'0009939',
'0007940',
'0008659',
'0007910',
'0008016',
'0007921',
'0007907',
'0009632',
'0009376',
'0007711',
'0009705',
'0008063',
'0008181',
'0008777',
'0007974',
'0008083',
'0007851',
'0007686',
'0009238',
'0007716',
'0009911',
'0007701',
'0009390',
'0008595',
'0007815',
'0008080',
'0008186',
'0008654',
'0009903',
'0007890',
'0009925',
'0009788',
'0009699',
'0008752',
'0009608',
'0007827',
'0009766',
'0007736',
'0009190',
'0007727',
'0009593',
'0007966',
'0007877',
'0009297',
'0008298',
'0007794',
'0007864',
'0007845',
'0007842',
'0009579',
'0008608',
'0008303',
'0009941',
'0009242',
'0008018',
'0007729',
'0009512',
'0007977',
'0008035',
'0008667',
'0009669',
'0008015',
'0009332',
'0007857',
'0007958',
'0009932',
'0008855',
'0009658',
'0008078',
'0007724',
'0008202',
'0008329',
'0009517',
'0008496',
'0008866',
'0009633',
'0007743',
'0009178',
'0008033',
'0007773',
'0008056',
'0008879',
'0008728',
'0008338',
'0008069',
'0008851',
'0007675',
'0007832',
'0009281',
'0008666',
'0007895',
'0009348',
'0009259',
'0008657',
'0008129',
'0007934',
'0007800',
'0007881',
'0009397',
'0007756',
'0009540',
'0009550',
'0009300',
'0008071',
'0008028',
'0009393',
'0008188',
'0009769',
'0007962',
'0007972',
'0009654',
'0009403',
'0008184',
'0009624',
'0009643',
'0007776',
'0008769',
'0007687',
'0009200',
'0007837',
'0008535',
'0007957',
'0007824',
'0009294',
'0008770',
'0007797',
'0009159',
'0009646',
'0007943',
'0007730',
'0009924',
'0008668',
'0008784',
'0008677',
'0008527',
'0007817',
'0007787',
'0007836',
'0008285',
'0009278',
'0008344',
'0009330',
'0008916',
'0009639',
'0007924',
'0008306',
'0008556',
'0007775',
'0008245',
'0007682',
'0007911',
'0009380',
'0007863',
'0007685',
'0007792',
'0009257',
'0008039',
'0008208',
'0009597',
'0007766',
'0009707',
'0008058',
'0009918',
'0009391',
'0007980',
'0007814',
'0009606',
'0008536',
'0009529',
'0007735',
'0008708',
'0008332',
'0009213',
'0008811',
'0009303',
'0008187',
'0007861',
'0007795',
'0007998',
'0007688',
'0008012',
'0008678',
'0008023',
'0008086',
'0008169',
'0009940',
'0009758',
'0007963',
'0008792',
'0007746',
'0009583',
'0009226',
'0009677',
'0009333',
'0008391',
'0007856',
'0007959',
'0008060',
'0008790',
'0008068',
'0009587',
'0008305',
'0007932',
'0008182',
'0007894',
'0009179',
'0007949',
'0008707',
'0007805',
'0009313',
'0009586',
'0009148',
'0009319',
'0008394',
'0007784',
'0009166',
'0009786',
'0007903',
'0007770',
'0008781',
'0009701',
'0007973',
'0008291',
'0008185',
'0009370',
'0007690',
'0008037',
'0009210',
'0009649',
'0009795',
'0007981',
'0007705',
'0009394',
'0007960',
'0007811',
'0009760',
'0009904',
'0007731',
'0009241',
'0007839',
'0008848',
'0008201',
'0007823',
'0009909',
'0009721',
'0008212',
'0008059',
'0008829',
'0007888',
'0009172',
'0007846',
'0009271',
'0007722',
'0008224',
'0009922',
'0008133',
'0007850',
'0009783',
'0008345',
'0009562',
'0009336',
'0009253',
'0008795',
'0008684',
'0008275',
'0009186',
'0007748',
'0009929',
'0009084',
'0007904',
'0008594',
'0008052',
'0007793',
'0009582',
'0008232',
'0007841',
'0008220',
'0009907',
'0007702',
'0008077',
'0007919',
'0008709',
'0007745',
'0007695',
'0008610',
'0009363',
'0007909',
'0008716',
'0008030',
'0008741',
'0007833',
'0008022',
'0008531',
'0007820',
'0007806',
'0009662',
'0008671',
'0009569',
'0008397',
'0008827',
'0007933',
'0007734',
'0008640',
'0009395',
'0008818',
'0008481',
'0009161',
'0007986',
'0008310',
'0007760',
'0008246',
'0008340',
'0009371',
'0009162',
'0008278',
'0008041',
'0007920',
'0009720',
'0009515',
'0009185',
'0009356',
'0007855',
'0007978',
'0008101',
'0008241',
'0008702',
'0009384',
'0007867',
'0007796',
'0009286',
'0009928',
'0009588',
'0008405',
'0008225',
'0009686',
'0008075',
'0009344',
'0009558',
'0009110',
'0007798',
'0008743',
'0008073',
'0008320',
'0007865',
'0007693',
'0009772',
'0009709',
'0007718',
'0007739',
'0008019',
'0008528',
'0008204',
'0008215',
'0008744',
'0009692',
'0008574',
'0008027',
'0008272',
'0008778',
'0009249',
'0009538',
'0009595',
'0007967',
'0008782',
'0009560',
'0007799',
'0009155',
'0008089',
'0009337',
'0009708',
'0007922',
'0008296',
'0009775',
'0009328',
'0009033',
'0009266',
'0008683',
'0008289',
'0008218',
'0009327',
'0008070',
'0007725',
'0007801',
'0008243',
'0008062',
'0009651',
'0009314',
'0008087',
'0009734',
'0008031',
'0009176',
'0008265',
'0008839',
'0007969',
'0008858',
'0007979',
'0008295',
'0008661',
'0008510',
'0008047',
'0007694',
'0009347',
'0007879',
'0008054',
'0008223',
'0009580',
'0008335',
'0008313',
'0009315',
'0007964',
'0007938',
'0007774',
'0008034',
'0008704',
'0009770',
'0008067',
'0008293',
'0008735',
'0007786',
'0008480',
'0008216',
'0008297',
'0007927',
'0007719',
'0007988',
'0009335',
'0008040',
'0008605',
'0008760',
'0007726',
'0008021',
'0009377',
'0008875',
'0009926',
'0007854',
'0007691',
'0008271',
'0008013',
'0008791',
'0008868',
'0009367',
'0009325',
'0008680',
'0007765',
'0009283',
'0007698',
'0008803',
'0007835',
'0007900',
'0008810',
'0008824',
'0007757',
'0008772',
'0008584',
'0009653',
'0009743',
'0009175',
'0008725',
'0009674',
'0009381',
'0007994',
'0008738',
'0007862',
'0009265',
'0009334',
'0009165',
'0007706',
'0007692',
'0007816',
'0008045',
'0009616',
'0008529',
'0007741',
'0009914',
'0007968',
'0007952',
'0008189',
'0009943',
'0009222',
'0007848',
'0009773',
'0009230',
'0009727',
'0008256',
'0008745',
'0008783',
'0009398',
'0008026',
'0008309',
'0008203',
'0007802',
'0009636',
'0007898',
'0008675',
'0009600',
'0009279',
'0009196',
'0008389',
'0008682',
'0009931',
'0009526',
'0007948',
'0007788',
'0007918',
'0008793',
'0009193',
'0009365',
'0007929',
'0008263',
'0009596',
'0008540',
'0009792',
'0009168',
'0009921',
'0008288',
'0009177',
'0008801',
'0009352',
'0009561',
'0007950',
'0009565',
'0008740',
'0007945',
'0008276',
'0009581',
'0009567',
'0008264',
'0009170',
'0007982',
'0007878',
'0009268',
'0007849',
'0008222',
'0007785',
'0008720',
'0009167',
'0009638',
'0009780',
'0008641',
'0009691',
'0009289',
'0008663',
'0009682',
'0008046',
'0009340',
'0009714',
'0009771',
'0009729',
'0008290',
'0007708',
'0009791',
'0009220',
'0008213',
'0007939',
'0008074',
'0008036',
'0009351',
'0009648',
'0008705',
'0007697',
'0008066',
'0007678',
'0008830',
'0009235',
'0008020',
'0008132',
'0008646',
'0009912',
'0009933',
'0008715',
'0009635',
'0008834',
'0009573',
'0009591',
'0008396',
'0009756',
'0007807',
'0009151',
'0008672',
'0009905',
'0009923',
'0007738',
'0008877',
'0009620',
'0008660',
'0009574',
'0007829',
'0009650',
'0009037',
'0008797',
'0007808',
'0009733',
'0007946',
'0008274',
'0007683',
'0009794',
'0009744',
'0007699',
'0009622',
'0007844',
'0009298',
'0008079',
'0009219',
'0009189',
'0009663',
'0008112',
'0009400',
'0007995',
'0009920',
'0009594',
'0008283',
'0007908',
'0009299',
'0007944',
'0007917',
'0007985',
'0008726',
'0008199',
'0008043',
'0008050',
'0008227',
'0008076',
'0009399',
'0007821',
'0009621',
'0008317',
'0009915',
'0008841',
'0009697',
'0007942',
'0009610',
'0008700',
'0008401',
'0009338',
'0008819',
'0007887',
'0008262',
'0007680',
'0009233',
'0007859',
'0009685',
'0007871',
'0009199',
'0008025',
'0009373',
'0008328',
'0008800',
'0009731',
'0009936',
'0009534',
'0009750',
'0008017',
'0008440',
'0009576',
'0007906',
'0008665',
'0008533',
'0008229',
'0009655',
'0009451',
'0009704',
'0008807',
'0007951',
'0009615',
'0007997',
'0009518',
'0008814',
'0008832',
'0008244',
'0007870',
'0008776',
'0009657',
'0009747',
'0009688',
'0009171',
'0009715',
'0007941',
'0009247',
'0008721',
'0007869',
'0009385',
'0007990',
'0009930',
'0009690',
'0008655',
'0007987',
'0009902',
'0008219',
'0008190',
'0008748',
'0007696',
'0009800',
'0009401',
'0009612',
'0009453',
'0009345',
'0009913',
'0009147',
'0008299',
'0007843',
'0008513',
'0007912',
'0008402',
'0009641',
'0008230',
'0009392',
'0001230',
'0002906',
'0003484',
'0003405',
'0003496',
'0003576',
'0004602',
'0002283',
'0004290',
'0002839',
'0002435',
'0003589',
'0002836',
'0002206',
'0003503',
'0002314',
'0001323',
'0004643',
'0002930',
'0003698',
'0004025',
'0003573',
'0004462',
'0002422',
'0004175',
'0004229',
'0004546',
'0004294',
'0002208',
'0001165',
'0001430',
'0004495',
'0004358',
'0002813',
'0003643',
'0001502',
'0003560',
'0004018',
'0002444',
'0004623',
'0004595',
'0004204',
'0004388',
'0001153',
'0003385',
'0002458',
'0003445',
'0003489',
'0004638',
'0004520',
'0003446',
'0002919',
'0002484',
'0003321',
'0001140',
'0003450',
'0004545',
'0004574',
'0003443',
'0003736',
'0001331',
'0002867',
'0004428',
'0002472',
'0004585',
'0003634',
'0004247',
'0004537',
'0004129',
'0002368',
'0002825',
'0002429',
'0004214',
'0003469',
'0004297',
'0002876',
'0002916',
'0002296',
'0002849',
'0002847',
'0004188',
'0002900',
'0001070',
'0001810',
'0004640',
'0003512',
'0004135',
'0001966',
'0004043',
'0002505',
'0003578',
'0002455',
'0003338',
'0004089',
'0004483',
'0004636',
'0002468',
'0002905',
'0002412',
'0001005',
'0002917',
'0004624',
'0003742',
'0001197',
'0002404',
'0003686',
'0002516',
'0003995',
'0001405',
'0004445',
'0002495',
'0004517',
'0001099',
'0001189',
'0004527',
'0004634',
'0001035',
'0003433',
'0002348',
'0001412',
'0002471',
'0003081',
'0001414',
'0003955',
'0002383',
'0001507',
'0002927',
'0004196',
'0001204',
'0001158',
'0004275',
'0004502',
'0004159',
'0004207',
'0003590',
'0004577',
'0002499',
'0002313',
'0002865',
'0001061',
'0003587',
'0001954',
'0002481',
'0002826',
'0002907',
'0004174',
'0003622',
'0004154',
'0001308',
'0003452',
'0004140',
'0003493',
'0003681',
'0002230',
'0004594',
'0002814',
'0002418',
'0003467',
'0001199',
'0004611',
'0003958',
'0002415',
'0003495',
'0004423',
'0004371',
'0001420',
'0004361',
'0003610',
'0001419',
'0002120',
'0004404',
'0004241',
'0001310',
'0002823',
'0002902',
'0002830',
'0003465',
'0004521',
'0003602',
'0004641',
'0004038',
'0002925',
'0004173',
'0001217',
'0003028',
'0004384',
'0002293',
'0003497',
'0004479',
'0004420',
'0001422',
'0003567',
'0004251',
'0001231',
'0002910',
'0002824',
'0002428',
'0003479',
'0003569',
'0002449',
'0003667',
'0002866',
'0002848',
'0001961',
'0002223',
'0004189',
'0002901',
'0003351',
'0003542',
'0003480',
'0002854',
'0003401',
'0003492',
'0002846',
'0004617',
'0002496',
'0003765',
'0004088',
'0002431',
'0002912',
'0004153',
'0001421',
'0001327',
'0004593',
'0004482',
'0004444',
'0003580',
'0004119',
'0001183',
'0004626',
'0004571',
'0004430',
'0003564',
'0001428',
'0003431',
'0004443',
'0002089',
'0004100',
'0004450',
'0004627',
'0002270',
'0001425',
'0004316',
'0001214',
'0002376',
'0002236',
'0003998',
'0002224',
'0002289',
'0002859',
'0002254',
'0002864',
'0003952',
'0002480',
'0001159',
'0002211',
'0003628',
'0003766',
'0004141',
'0004201',
'0002479',
'0004425',
'0002476',
'0003448',
'0002870',
'0004382',
'0002478',
'0003494',
'0004040',
'0001300',
'0001211',
'0003718',
'0002843',
'0001202',
'0001403',
'0004586',
'0002508',
'0001418',
'0003966',
'0004413',
'0004052',
'0004549',
'0001311',
'0004047',
'0003557',
'0003548',
'0001137',
'0003346',
'0003529',
'0003903',
'0004540',
'0001181',
'0002409',
'0004516',
'0003694',
'0004485',
'0004255',
'0002321',
'0004179',
'0002837',
'0004232',
'0003701',
'0001426',
'0001830',
'0004441',
'0002491',
'0001086',
'0004508',
'0002323',
'0002225',
'0001168',
'0003303',
'0004128',
'0003478',
'0004431',
'0004564',
'0002475',
'0002448',
'0004123',
'0001964',
'0004630',
'0004409',
'0002222',
'0003613',
'0004029',
'0004030',
'0003392',
'0004203',
'0004609',
'0004022',
'0004299',
'0002878',
'0002861',
'0003583',
'0004457',
'0004106',
'0002452',
'0001322',
'0001415',
'0003550',
'0001020',
'0003455',
'0004340',
'0002234',
'0001032',
'0004126',
'0004615',
'0003320',
'0003491',
'0003684',
'0002845',
'0004375',
'0002926',
'0004353',
'0004184',
'0004543',
'0002088',
'0003377',
'0004215',
'0003389',
'0002515',
'0002877',
'0001170',
'0004534',
'0004160',
'0003691',
'0003408',
'0003617',
'0002459',
'0004256',
'0001401',
'0002834',
'0002438',
'0002812',
'0002928',
'0001009',
'0004628',
'0004525',
'0003953',
'0003609',
'0001251',
'0003761',
'0003999',
'0004655',
'0003304',
'0004301',
'0004507',
'0002297',
'0003454',
'0002829',
'0002425',
'0002355',
'0004362',
'0004057',
'0003424',
'0002326',
'0004383',
'0002358',
'0002518',
'0004311',
'0002879',
'0003968',
'0001131',
'0004570',
'0001017',
'0002227',
'0003604',
'0002509',
'0004187',
'0004104',
'0004454',
'0004359',
'0002850',
'0004264',
'0004248',
'0002201',
'0004459',
'0004465',
'0001205',
'0003438',
'0002492',
'0003192',
'0002408',
'0001001',
'0004411',
'0003459',
'0004335',
'0004046',
'0002463',
'0003323',
'0002209',
'0004338',
'0001547',
'0004486',
'0004440',
'0004471',
'0003466',
'0004216',
'0004551',
'0001172',
'0002231',
'0004197',
'0003486',
'0004644',
'0002443',
'0004565',
'0004657',
'0004408',
'0002457',
'0001154',
'0002298',
'0003697',
'0004472',
'0003612',
'0001321',
'0004490',
'0002372',
'0004464',
'0004202',
'0002462',
'0002325',
'0002860',
'0004313',
'0001316',
'0003623',
'0002818',
'0002215',
'0001146',
'0001804',
'0004120',
'0002511',
'0002815',
'0002833',
'0001134',
'0001015',
'0004107',
'0004518',
'0002852',
'0004321',
'0004182',
'0004370',
'0004170',
'0004044',
'0002844',
'0004185',
'0003485',
'0001215',
'0001206',
'0004484',
'0003350',
'0004127',
'0004315',
'0004217',
'0003962',
'0004161',
'0002461',
'0002311',
'0002831',
'0004034',
'0004076',
'0004289',
'0002929',
'0003682',
'0001190',
'0001171',
'0003690',
'0004060',
'0002221',
'0004172',
'0002498',
'0001261',
'0001216',
'0001956',
'0003311',
'0002828',
'0002424',
'0002487',
'0004395',
'0003083',
'0003500',
'0003664',
'0003568',
'0001182',
'0004169',
'0002446',
'0004194',
'0004487',
'0001960',
'0001129',
'0001234',
'0002467',
'0004105',
'0003619',
'0003481',
'0002855',
'0001174',
'0004461',
'0003944',
'0002301',
'0002432',
'0001957',
'0003336',
'0004573',
'0001016',
'0002853',
'0004152',
'0003458',
'0004102',
'0004191',
'0001326',
'0004220',
'0004366',
'0004115',
'0004592',
'0003475',
'0002874',
'0001036',
'0004332',
'0002922',
'0004122',
'0001152',
'0004267',
'0004269',
'0003947',
'0003680',
'0002841',
'0004357',
'0004180',
'0004451',
'0004211',
'0003696',
'0002450',
'0004658',
'0004023',
'0002442',
'0004078',
'0003677',
'0004582',
'0002346',
'0002367',
'0002816',
'0002520',
'0003624',
'0001201',
'0004587',
'0001033',
'0004453',
'0004250',
'0004199',
'0004292',
'0002360',
'0001091',
'0003575',
'0002421',
'0003993',
'0003449',
'0003700',
'0003428',
'0003376',
'0002908',
'0004020',
'0001402',
'0002272',
'0002210',
'0001203',
'0003403',
'0003435',
'0004659',
'0004476',
'0004629',
'0002460',
'0003556',
'0004633',
'0004421',
'0002205',
'0002513',
'0003528',
'0002842',
'0004314',
'0003648',
'0003570',
'0003444',
'0004317',
'0003582',
'0002238',
'0003456',
'0004477',
'0002474',
'0001191',
'0001963',
'0003637',
'0004049',
'0003482',
'0002856',
'0002447',
'0001424',
'0003309',
'0001427',
'0004653',
'0004589',
'0003562',
'0002240',
'0003473',
'0003369',
'0001264',
'0004249',
'0003460',
'0004151',
'0004500',
'0001325',
'0003535',
'0002322',
'0004460',
'0004591',
'0004639',
'0004572',
'0002503',
'0004186',
'0004648',
'0002344',
'0004588',
'0002263',
'0003474',
'0003671',
'0001302',
'0003996',
'0004087',
'0003502',
'0004103',
'0003436',
'0003737',
'0004369',
'0003555',
'0001530',
'0002034',
'0001411',
'0004470',
'0004181',
'0002356',
'0002918',
'0002427',
'0002506',
'0002838',
'0002434',
'0003368',
'0003409',
'0004552',
'0002465',
'0003605',
'0002333',
'0003685',
'0002835',
'0002439',
'0002275',
'0002521',
'0002433',
'0001194',
'0002407',
'0003585',
'0003384',
'0002493',
'0003390',
'0001076',
'0003969',
'0004535',
'0003642',
'0003447',
'0001090',
'0002514',
'0002420',
'0003471',
'0003561',
'0003453',
'0004449',
'0004310',
'0002380',
'0001156',
'0003530',
'0002473',
'0003487',
'0003488',
'0004526',
'0004455',
'0003434',
'0003923',
'0002851',
'0002018',
'0004230',
'0002305',
'0002329',
'0002915',
'0003673',
'0004226',
'0004334',
'0001416',
'0003588',
'0002441',
'0004293',
'0001220',
'0003505',
'0003547',
'0002232',
'0002413',
'0004125',
'0003633',
'0004548',
'0003571',
'0003636',
'0003187',
'0002875',
'0002466',
'0004654',
'0004032',
'0001219',
'0001432',
'0004024',
'0001047',
'0002454',
'0001319',
'0004575',
'0002121',
'0003407',
'0002488',
'0001192',
'0003472',
'0002086',
'0001417',
'0003620',
'0002517',
'0001404',
'0002494',
'0002295',
'0002819',
'0003352',
'0004491',
'0001262',
'0002371',
'0002486',
'0003440',
'0003345',
'0002334',
'0002243',
'0003586',
'0004237',
'0004045',
'0002470',
'0003060',
'0004488',
'0002500',
'0003670',
'0004097',
'0004116',
'0002214',
'0001207',
'0003540',
'0004646',
'0003510',
'0002832',
'0002202',
'0003521',
'0004635',
'0002464',
'0004519',
'0004647',
'0001224',
'0004298',
'0004035',
'0004604',
'0003683',
'0002426',
'0004171',
'0001083',
'0002507',
'0001305',
'0002406',
'0003574',
'0001028',
'0002233',
'0002203',
'0003592',
'0002414',
'0002456',
'0001195',
'0003027',
'0003470',
'0003328',
'0002419',
'0003959',
'0003672',
'0001143',
'0002911',
'0001157',
'0002080',
'0001423',
'0003615',
'0003362',
'0004021',
'0003477',
'0001505',
'0001260',
'0003949',
'0003464',
'0004356',
'0003442',
'0004601',
'0004342',
'0002869',
'0001958',
'0002920',
'0002483',
'0004086',
'0003653',
'0002090',
'0001259',
'0003457',
'0003650',
'0002213',
'0003956',
'0004195',
'0004243',
'0002817',
'0004533',
'0003310',
'0002909',
'0002821',
'0001025',
'0003764',
'0001018',
'0004544',
'0002306',
'0004083',
'0002073',
'0001232',
'0001829',
'0003960',
'0001848',
'0002308',
'0004118',
'0004165',
'0004027',
'0004554',
'0002451',
'0002423',
'0004632',
'0002502',
'0002430',
'0004528',
'0001218',
'0004620',
'0003591',
'0004497',
'0001193',
'0003572',
'0004637',
'0003991',
'0004513',
'0004385',
'0003581',
'0001431',
'0004523',
'0004210',
'0003437',
'0004448',
'0002872',
'0002242',
'0001180',
'0003774',
'0002510',
'0003654',
'0002445',
'0004341',
'0004131',
'0001962',
'0002923',
'0004183',
'0001200',
'0002501',
'0002290',
'0004631',
'0002273',
'0002477',
'0003483',
'0002857',
'0001429',
'0002858',
'0004652',
'0002485',
'0004056',
'0003462',
'0002822',
'0003635',
'0002285',
'0002903',
'0003626',
'0003451',
'0002512',
'0004058',
'0001163',
'0004590',
'0002453',
'0004610',
'0003463',
'0002317',
'0004419',
'0003326',
'0004337',
'0003379',
'0003593',
'0002122',
'0004213',
'0003559',
'0003632',
'0004378',
'0004178',
'0002871',
'0004650',
'0004400',
'0004506',
'0004625',
'0002504',
'0003439',
'0004132',
'0003461',
'0003661',
'0003994',
'0002469',
'0002319',
'0004166',
'0003606',
'0002868',
'0004618',
'0001026',
'0002921',
'0003614',
'0001213',
'0002405',
'0003476',
'0003652',
'0001413',
'0002229',
'0002332',
'0001400',
'0002490',
'0002411',
'0001959',
'0004539',
'0002482',
'0004621',
'0002820',
'0003341',
'0004645',
'0001041',
'0001433',
'0004095',
'0003498',
'0001167',
'0002382',
'0001965',
'0004333',
'0004583')

INSERT @supplier (supplier_id, name)
SELECT s.supplier_id, s.name
FROM   supplier_da_effective_date_list as l
JOIN   supplier AS s
ON     l.supplier_id = s.supplier_id
JOIN   rad_sys_data_accessor as rsda
ON     l.data_accessor_id = rsda.data_accessor_id
JOIN   business_unit_group as bug
ON     bug.business_unit_group_id = rsda.data_accessor_id
WHERE  EXISTS (SELECT 1
              FROM Business_Unit_Group_List as bugl
              JOIN @Business_Unit AS bu
              ON   bug.business_unit_group_id = bugl.business_unit_group_id
			  AND  bugl.business_unit_id = bu.business_unit_id)
AND	   s.status_code <> 'i'
-- Added per request to exclude Franchise suppliers
AND	   SUBSTRING(s.name, 1, 2) <> 'F_'
-- End additional code
UNION 			  
SELECT s.supplier_id, s.name
FROM   supplier_da_effective_date_list as l
JOIN   supplier AS s
ON     l.supplier_id = s.supplier_id
JOIN   rad_sys_data_accessor as rsda
ON     l.data_accessor_id = rsda.data_accessor_id
JOIN   @business_unit as bu
ON     bu.business_unit_id = rsda.data_accessor_id
WHERE  s.status_code <> 'i'
-- Added per request to exclude Franchise suppliers
AND	   SUBSTRING(s.name, 1, 2) <> 'F_'
-- End additional code

IF OBJECT_ID('tempdb..#supplier_item_counts') IS NOT NULL
    DROP TABLE #supplier_item_counts
CREATE TABLE #supplier_item_counts
(supplier_id int,
 supplier_item_id int,
 cost_level_count int,
 barcode_count int)
 
IF OBJECT_ID('tempdb..#supplier_item_extract') IS NOT NULL
    DROP TABLE #supplier_item_extract
CREATE TABLE #supplier_item_extract
(supplier_id int not null,
 supplier_item_id int not null,
 supplier_item_row_number int not null,
 supplier_item_code nvarchar(50) not null,
 barcode_type nvarchar(1) null,
 barcode_number nvarchar(255) null,
 cost_level_name nvarchar(50) null,
 package_cost smallmoney null,
 package_allowance smallmoney null,
 start_date smalldatetime null,
 end_date smalldatetime null)
 
CREATE INDEX IX1 ON #supplier_item_extract (supplier_id, supplier_item_id, supplier_item_row_number)

IF OBJECT_ID('tempdb..#supplier_item_count_batch') IS NOT NULL
    DROP TABLE #supplier_item_count_batch
CREATE TABLE #supplier_item_count_batch
(supplier_xref nvarchar(50),
 supplier_name nvarchar(50),
 batch_total int,
 batch_count int)

IF OBJECT_ID('tempdb..#talley') IS NOT NULL
    DROP TABLE #talley

CREATE TABLE #talley (batch_number int)
INSERT #talley SELECT 1
INSERT #talley SELECT 2    
INSERT #talley SELECT 3
INSERT #talley SELECT 4
INSERT #talley SELECT 5
INSERT #talley SELECT 6
INSERT #talley SELECT 7
INSERT #talley SELECT 8
INSERT #talley SELECT 9
INSERT #talley SELECT 10
INSERT #talley SELECT 11
INSERT #talley SELECT 12
INSERT #talley SELECT 13
INSERT #talley SELECT 14
INSERT #talley SELECT 15
INSERT #talley SELECT 16
INSERT #talley SELECT 17
INSERT #talley SELECT 18
INSERT #talley SELECT 19
INSERT #talley SELECT 20
INSERT #talley SELECT 21
INSERT #talley SELECT 22
INSERT #talley SELECT 23
INSERT #talley SELECT 24
INSERT #talley SELECT 25
INSERT #talley SELECT 26
INSERT #talley SELECT 27
INSERT #talley SELECT 28
INSERT #talley SELECT 29
INSERT #talley SELECT 30
INSERT #talley SELECT 31
INSERT #talley SELECT 32
INSERT #talley SELECT 33
INSERT #talley SELECT 34
INSERT #talley SELECT 35
INSERT #talley SELECT 36
INSERT #talley SELECT 37
INSERT #talley SELECT 38
INSERT #talley SELECT 39
INSERT #talley SELECT 40
INSERT #talley SELECT 41
INSERT #talley SELECT 42
INSERT #talley SELECT 43
INSERT #talley SELECT 44
INSERT #talley SELECT 45
INSERT #talley SELECT 46
INSERT #talley SELECT 47
INSERT #talley SELECT 48
INSERT #talley SELECT 49
INSERT #talley SELECT 50

INSERT #Supplier_Item_Counts(Supplier_Id, Supplier_Item_Id, Cost_Level_Count, Barcode_Count)  
SELECT si.supplier_Id, si.supplier_item_id, clc.cost_level_count, barcode_count
FROM supplier_item AS si (NOLOCK)

JOIN @supplier AS s
ON  si.supplier_id = s.supplier_Id

LEFT JOIN (SELECT supplier_Id, supplier_Item_Id, COUNT(*) AS cost_level_count
      FROM merch_cost_change AS mcc (NOLOCK)
      WHERE mcc.promo_flag IN ('n')
      AND mcc.change_type_code IN ('a','c') 
      AND mcc.start_date <= @MerchCostChangeEffectiveDate
      AND	(mcc.end_date > @MerchCostChangeEffectiveDate
      OR	mcc.end_date IS NULL)
      GROUP BY supplier_id, supplier_item_id) AS clc
ON  si.supplier_id = clc.supplier_id
AND si.supplier_item_id = clc.supplier_item_id
LEFT JOIN (SELECT supplier_Id, supplier_Item_Id, COUNT(*) AS barcode_count
      FROM supplier_item_barcode AS sib (NOLOCK)
      WHERE barcode_type_code IN ('e','g','u')
      GROUP BY supplier_id, supplier_item_id) AS bcc
ON  si.supplier_id = bcc.supplier_id
AND si.supplier_item_id = bcc.supplier_item_id

INSERT #supplier_item_extract
(supplier_id,
 supplier_item_id,
 supplier_item_row_number,
 supplier_item_code,
 cost_level_name,
 package_cost,
 package_allowance,
 start_date,
 end_date)

SELECT sics.supplier_id,
sics.supplier_item_id,
ROW_NUMBER() over (partition by spi.supplier_item_code order by spi.supplier_item_code, mcl.merch_cost_level_id) AS supplier_item_row_number, 
spi.supplier_item_code,
mcl.name,
mcc.supplier_price,
mcc.supplier_allowance,
mcc.start_date,
mcc.end_date
FROM #supplier_item_counts AS sics (NOLOCK)
JOIN Supplier_Packaged_Item AS spi (NOLOCK)
ON   spi.supplier_id = sics.supplier_id
AND  spi.supplier_item_id = sics.supplier_item_id
JOIN merch_cost_change AS mcc (NOLOCK)
ON   spi.supplier_id = mcc.supplier_id
AND  spi.supplier_item_id = mcc.supplier_item_id
JOIN Merch_Cost_Level as mcl (NOLOCK)
ON   mcl.supplier_id = mcc.supplier_id
AND  mcl.merch_cost_level_id = mcc.merch_cost_level_id
WHERE mcc.promo_flag IN ('n')
AND mcc.change_type_code IN ('a','c') 
AND mcc.start_date <= @MerchCostChangeEffectiveDate
AND	(mcc.end_date > @MerchCostChangeEffectiveDate
OR	mcc.end_date IS NULL)
AND ISNULL(sics.barcode_count,0) < sics.cost_level_count

INSERT #supplier_item_extract
(supplier_id,
 supplier_item_id,
 supplier_item_row_number,
 supplier_item_code,
 barcode_type,
 barcode_number)

SELECT sics.supplier_id,
sics.supplier_item_id,
ROW_NUMBER() over (partition by spi.supplier_item_code order by spi.supplier_item_code, sib.barcode_type_code, sib.barcode_number) AS supplier_item_row_number, 
spi.supplier_item_code,
sib.barcode_type_code,
sib.barcode_number
FROM #supplier_item_counts AS sics
JOIN Supplier_Packaged_Item AS spi
ON   spi.supplier_id = sics.supplier_id
AND  spi.supplier_item_id = sics.supplier_item_id
JOIN supplier_item_barcode AS sib
ON sics.supplier_id = sib.supplier_id
AND sics.supplier_item_id = sib.supplier_item_id
WHERE barcode_type_code IN ('e','g','u')
AND ISNULL(sics.barcode_count,0) >= sics.cost_level_count

UPDATE sie
SET sie.barcode_type = bc.barcode_type_code,
sie.barcode_number = bc.barcode_number
FROM #supplier_item_extract AS sie
JOIN (SELECT sics.supplier_id,
      sics.supplier_item_id,
      ROW_NUMBER() over (partition by spi.supplier_item_code order by spi.supplier_item_code, sib.barcode_type_code, sib.barcode_number) AS supplier_item_row_number, 
      spi.supplier_item_code,
      sib.barcode_type_code,
      sib.barcode_number
      FROM #supplier_item_counts AS sics
      JOIN Supplier_Packaged_Item AS spi
      ON   spi.supplier_id = sics.supplier_id
      AND  spi.supplier_item_id = sics.supplier_item_id
      JOIN supplier_item_barcode AS sib
      ON sics.supplier_id = sib.supplier_id
      AND sics.supplier_item_id = sib.supplier_item_id
      WHERE barcode_type_code IN ('e','g','u')
      AND ISNULL(sics.barcode_count,0) < sics.cost_level_count ) AS bc
ON sie.supplier_Id = bc.supplier_Id
AND sie.supplier_Item_Id = bc.supplier_Item_Id
AND sie.supplier_item_row_number = bc.supplier_item_row_number

UPDATE sie
SET sie.cost_level_name = mcc.name,
    sie.package_cost = mcc.supplier_price,
    sie.package_allowance = mcc.supplier_allowance,
    sie.start_date = mcc.start_date,
    sie.end_date = mcc.end_date
FROM #supplier_item_extract AS sie
JOIN (SELECT sics.supplier_id,
      sics.supplier_item_id,
      ROW_NUMBER() over (partition by spi.supplier_item_code order by spi.supplier_item_code, mcl.merch_cost_level_id) AS supplier_item_row_number, 
      spi.supplier_item_code,
      mcl.name,
      mcc.supplier_price,
      mcc.supplier_allowance,
      mcc.start_date,
      mcc.end_date
      FROM #supplier_item_counts AS sics (NOLOCK)
      JOIN Supplier_Packaged_Item AS spi (NOLOCK)
      ON   spi.supplier_id = sics.supplier_id
      AND  spi.supplier_item_id = sics.supplier_item_id
      JOIN merch_cost_change AS mcc (NOLOCK)
      ON   spi.supplier_id = mcc.supplier_id
      AND  spi.supplier_item_id = mcc.supplier_item_id
      JOIN Merch_Cost_Level as mcl (NOLOCK)
      ON   mcl.supplier_id = mcc.supplier_id
      AND  mcl.merch_cost_level_id = mcc.merch_cost_level_id
      WHERE mcc.promo_flag IN ('n')
      AND mcc.change_type_code IN ('a','c') 
      AND mcc.start_date <= @MerchCostChangeEffectiveDate
      AND	(mcc.end_date > @MerchCostChangeEffectiveDate
      OR	mcc.end_date IS NULL)
      AND sics.barcode_count >= sics.cost_level_count) AS mcc
ON sie.supplier_Id = mcc.supplier_Id
AND sie.supplier_Item_Id = mcc.supplier_Item_Id
AND sie.supplier_item_row_number = mcc.supplier_item_row_number

INSERT #supplier_item_count_batch
SELECT  ISNULL(s.xref_code, 'xref-' + CONVERT(NVARCHAR(15),s.supplier_id)) AS XRefCode,
s.name,
COUNT(*),
CEILING(COUNT(*)/10000)+1 
FROM  #supplier_item_extract AS sie
INNER JOIN Supplier_Item AS si 
ON    sie.supplier_id = si.supplier_id
AND   sie.supplier_item_id = si.supplier_item_id
INNER JOIN Supplier AS s
ON    si.supplier_id = s.supplier_id
INNER JOIN Supplier_Item_Category AS sic
ON    si.supplier_item_category_id = sic.supplier_item_category_id
AND   si.supplier_id = sic.supplier_id
INNER JOIN Supplier_Packaged_Item AS spi
ON    si.supplier_item_id = spi.supplier_item_id
AND   si.supplier_id = spi.supplier_id
INNER JOIN Unit_of_Measure AS uom
ON    spi.packaged_in_uom_id = uom.unit_of_measure_id
INNER JOIN Rad_Sys_Client AS rsc
ON s.client_id = rsc.client_id
INNER JOIN Rad_Sys_Data_Accessor AS rsda 
ON rsc.client_id = rsda.data_accessor_id
LEFT JOIN Item AS i
ON si.item_id = i.item_id
WHERE	s.status_code IN ('a')
AND s.supplier_type_code IN ('m') 
AND si.status_code in ('a','u')
-- Added for support of incremental extract
AND si.supplier_item_id > @last_max_id
-- END for additional changes
AND i.purge_flag IN ('n')
AND (CASE 
	WHEN	(ISNUMERIC(i.xref_code) = 1 
			AND LEN(i.xref_code) < 9
     		AND LEFT(i.xref_code, 1) NOT IN ('0')
			AND i.xref_code NOT LIKE '%[^0-9]%' 
			)	THEN CONVERT(int, i.xref_code)
			WHEN i.xref_code IS NULL THEN 0
			ELSE	-1
			END	) >= 0
--AND s.xref_code = 'ABBEVRGE'
--AND s.xref_code IN ('PEPSINT3')
		
GROUP BY ISNULL(s.xref_code, 'xref-' + CONVERT(NVARCHAR(15),s.supplier_id)), s.name
ORDER BY 3 DESC

SELECT b.batch_count,
t.batch_number-1,
b.supplier_xref,
REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(b.supplier_name,'/',' '),',',' '),'_',' '),'[',' '), ']',' '),
CASE WHEN t.batch_number < 10 THEN '0' + CONVERT(NVARCHAR(1), t.batch_number) ELSE CONVERT(NVARCHAR(2), t.batch_number) END
FROM #supplier_item_count_batch as b
JOIN #talley as t
ON   t.batch_number <= b.batch_count
ORDER BY b.batch_total DESC, t.batch_number

IF OBJECT_ID('tempdb..#supplier_item_counts') IS NOT NULL
    DROP TABLE #supplier_item_counts
    
IF OBJECT_ID('tempdb..#supplier_item_extract') IS NOT NULL
    DROP TABLE #supplier_item_extract

IF OBJECT_ID('tempdb..#talley') IS NOT NULL
    DROP TABLE #talley
    
IF OBJECT_ID('tempdb..#supplier_item_count_batch') IS NOT NULL
    DROP TABLE #supplier_item_count_batch
    
